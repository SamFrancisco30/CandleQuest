# 盘感训练应用开发需求
​
## 项目目标
​
开发一个盘感训练App，以游戏的形式让用户培养盘感，提升交易水平。

## 特殊需求
目前仅支持美股普通股票，暂不支持加密货币和A股市场
​
## 技术栈
​
- **前端框架**: React.js (v18+) - 现代、组件化，适合动态UI
- **开发语言**: TypeScript
- **样式处理**: Tailwind CSS
- **数据存储**: Supabase
- **K线图展示**: TradingView Lightweight Charts

​
## 功能需求
​
1. **模式 1：模拟实盘模式（经典训练）**
   - 系统随机截取历史 K 线（可以是日线、1h、5min 等）
   - 用户只能看到到某一时刻的数据，接下来几根 K 线被“隐藏”
   - 用户做出操作（买入 / 卖出 / 空仓）
   - 系统揭示后续K线，基于盈亏打分（见业务逻辑）
   - 可将错误案例加入错题本
​
2. **模式 2：快速选择题模式（反应训练）**
   - 系统展示某一时刻的 K 线图以及预测周期（例如1个月后）
   - 用户在10秒内选择：上涨/下跌/震荡
   - 系统立即揭示结果，更新正确率统计
   - 可将错误案例加入错题本

​
3. **错题本**
   - 记录模式1/2中的错误案例，支持查看K线、用户操作、实际结果

4. **用户系统**
   - 免登录设计，使用UUID生成唯一用户ID
   - 支持查看个人统计（总得分、正确率、训练次数）
   - 首次访问自动生成用户ID并初始化
​
5. **响应式设计**
   - 适配移动端、平板和桌面设备
   - 不同设备有合适的布局和交互方式
​
## 数据存储设计
​
### 主要数据结构
**users表**：存储用户的唯一标识和创建时间
- id: UUID (主键，唯一用户标识)
- created_at: timestamp (创建时间)
- last_active: timestamp (最后活跃时间，用于活跃度分析)


**training_sessions 表**：存储训练记录
- id: UUID (主键，唯一用户标识)
- user_id: UUID (外键，关联users.id)
- mode: string (模式1或模式2)
- kline_symbol: string (标的，如"TSLA")
- kline_interval: string (周期，如"1d")
- start_timestamp: timestamp (K线截取起点)
- user_action: string (模式1：buy/sell/hold；模式2：up/down/flat)
- actual_outcome: string (实际结果)
- score: integer (得分，0-100)
- is_wrong: boolean (是否错误，用于错题本)
- created_at: timestamp (创建时间)

​**mistakes表**：错题本
- id: UUID (主键)
- user_id: UUID (外键，关联users.id)
- created_at: timestamp (创建时间)
- session_id: UUID (外键，关联training_sessions.id)

### 数据关系说明
​
1. 一对多：一个用户 (users) 可有多个训练会话 (training_sessions) 和错题记录 (mistakes)。
2. 外键引用：mistakes.session_id关联training_sessions.id，便于复盘完整上下文。
3. 设计考量：Supabase的PostgreSQL支持高效查询（如平均得分：SELECT AVG(score) FROM training_sessions WHERE user_id = ?）。K线数据建议动态拉取（API），仅缓存热门数据以节省存储。
​
## 业务逻辑设计
### ​模式1：模拟实盘模式

1. 用户选择标的和周期（如TSLA，日线）。
2. 系统从API拉取历史K线，随机截取100根，隐藏最后5-10根。
3. 显示K线图（Recharts烛台图），用户选择：买入/卖出/空仓。
4. 揭示后续K线，计算盈亏：

- 盈亏% = (结束价 - 买入价)/买入价 * 100。
- 得分规则：盈亏>5%得100分，盈亏<-5%得0分，线性插值。

5. 错误案例可加入错题本（is_wrong=true）。
6. 记录到training_sessions表。

### ​模式2：快速选择题模式

1. 系统随机选K线截点和预测周期（如20根日线）。
2. 显示K线图，10秒倒计时。
3. 用户选择：上涨（>5%）、下跌（<-5%）、震荡（-5%~5%）。
4. 揭示结果，更新正确率（LocalStorage或Supabase）
5. 错误案例可加入错题本

- 盈亏% = (结束价 - 买入价)/买入价 * 100。
- 得分规则：盈亏>5%得100分，盈亏<-5%得0分，线性插值。

5. 错误案例可加入错题本（is_wrong=true）。
6. 记录到training_sessions表。
​

### 错题本逻辑
1. 查询training_sessions中is_wrong=true的记录
2. 支持查看详情（K线+操作+结果）、重玩或添加笔记（更新mistakes表）

### 用户系统逻辑
1. 页面加载检查LocalStorage.userId，无则生成UUID，插入users表
2. 所有操作带userId查询/插入数据

## 用户体验设计
​
1. **页面布局**
- 首页：欢迎语 + 模式选择（模式1/2/错题本） + 统计卡片（总得分、正确率）。
- 训练页：顶部K线图，中间操作按钮（模式1：买入/卖出/空仓；模式2：上涨/下跌/震荡），底部得分/结果揭示区，模式2含倒计时。
- 错题本页：列表视图（每项显示缩略K线、操作、结果、笔记），支持点击展开详情。
- 全局：移动端底部导航栏，桌面端侧边栏，支持暗黑模式。
​
2. **交互设计**
- K线交互：支持缩放（移动端捏合，桌面滚轮），点击高亮K线。
- 反馈：操作后动画（绿/红闪现表示盈亏），得分弹出提示。
- 按钮：使用Tailwind类（如bg-green-500 hover:bg-green-600），确保触控友好。
- 进度：显示“第X/10题”，结束时弹出总结报告（正确率、得分）。

​
3. **响应式适配**
- Tailwind媒体查询：mobile-first（sm: 平板, md: 桌面）。
- 移动端：全屏K线，简化按钮布局。
- 桌面端：侧边统计面板，更多交互空间。
- 测试：用Chrome DevTools/BrowserStack验证
​
## 实施步骤
​
### 1. 项目初始化与环境配置
​
```bash
# 创建React.js项目
npx create-react-app candle-quest-app --template typescript
cd candle-quest-app

# 安装依赖
npm install @supabase/supabase-js uuid recharts axios
npm install -D @types/uuid tailwindcss postcss autoprefixer

# 配置Tailwind CSS
npx tailwindcss init -p
# 编辑tailwind.config.js
content: ['./src/**/*.{js,ts,jsx,tsx}']
# 编辑src/index.css
@tailwind base; @tailwind components; @tailwind utilities;
```
​
### 2. 数据库设置
1. 创建Supabase项目
2. 创建必要的数据表
3. 设置适当的访问权限
​
### 3. 项目结构搭建
​
1. 创建基础目录结构
2. 配置Supabase客户端
3. 实现用户ID生成和管理功能
​
### 4. 组件开发
- KlineChart：绘制烛台图，接受K线数据props。
- TrainingPage：集成K线图、按钮、倒计时（useEffect）。
- MistakesPage：列表+模态，支持笔记编辑。
- StatsCard：显示用户统计（查询Supabase）。
​
### 5. 数据交互实现
- ​拉取K线：从Alpha Vantage获取美股历史数据。
- CRUD操作：Supabase插入/查询训练记录和错题。
- 随机逻辑：前端Math.random()选择K线截点。

​
### 6. 优化与测试
​
1. 性能优化
2. 跨设备测试
3. 边缘情况处理
​
​
